require.config({baseUrl:"dist",paths:{typeahead:"../assets/js/typeahead.bundle.min",doT:"../assets/js/doT.min","hc-theme":"../assets/highcharts/themes/grid",anounymous:"ProtoUtil","s-t":"../assets/js/stupidtable.min"},urlArgs:"_0.162"}).onError=function(t){throw console.log(t.requireType),"timeout"===t.requireType&&console.log("modules: "+t.requireModules),t},window.Promise||(console.log("patch to support Promise"),function(){var t,e,a,r,o=document.getElementsByTagName("script");e="assets/js/promise-6.1.0.min.js",(t=document.createElement("script")).src=e,t.async=a,r&&o?o[0].parentNode.insertBefore(t,o[0]):document.body.appendChild(t)}());var global={category:null,cr:{t:"©刀小一"},startDate:"1995-01",$factSet:null,datum:null,maxTryTimes:2,cache:!1,debug:!1};!function(a,r){a.cacheScript=function(t,e){return e=a.extend(e||{},{dataType:"script",cache:r.cache,url:t}),a.ajax(e)},a.cacheJSON=function(t,e){return e=a.extend(e||{},{dataType:"json",cache:r.cache,url:t}),a.ajax(e)},a.cacheTemplate=function(t){var e={type:"GET",dataType:"html",cache:r.cache};return Array.isArray(t)?Promise.all(t.map(function(n){return new Promise(function(r,o){a.ajax(require.s.contexts._.config.baseUrl+"tmpl/"+n.file,e).done(function(t,e,a){r({id:n.id,content:t})}).fail(function(t,e,a){o(a)})})})):new Promise(function(t,e){e("template: cannot support")})}}(jQuery,global),ErrorHandler={_$error:null,init:function(){_$error=$("#error-panel > p"),window.onerror=function(t,e,a,r,o){ErrorHandler.show(t)}},show:function(t){_$error.text(t).parent().transition("fade")},hide:function(){_$error.parent().transition("hide")}},require(["u","t","f","doT","e","peg","e0","peg0","e1","peg1","anounymous","typeahead","hc-theme","s-t"],function(s,u,g,f,p,h,d,m,b,y){$.cacheTemplate([{file:"t-sets.html",id:"__set1"},{file:"f-t.html",id:"taFactor"},{file:"f-f.html",id:"faFactor"},{file:"f-f-t.html",id:"faTable"}]).then(function(t){var e={};t.forEach(function(t){t.id.startsWith("__")?a(t.content,e):e[t.id]=f.template(t.content)}),f.tmpls=e,$(function(){global.$factSet=[$("#fact-chart-0"),$("#fact-set-0"),$("#fact-chart-1"),$("#fact-chart-2"),$("#fact-set-1"),$("#fact-set-2"),$("#security-info")];var e=$("#category"),a=$("#sector"),n=$("#symbol");ErrorHandler.init(),$(".menu .item").tab();var r=window.location.hash;if(r){var t=/#f=(-\d|\d)/g.exec(decodeURIComponent(r));t&&2===t.length&&(r=parseInt(t[1],10))}Promise.all(["world","sg"].map(function(a){return e.append(l(a,a.toUpperCase())),new Promise(function(e,t){require([a],function(t){e(t.filter(function(t){return t.cat=a,""===r||t.f===r}))})})})).then(function(t){var r,o={};t.forEach(function(t){t.forEach(function(t,e){0===e&&(o[t.cat]={}),t.s&&(o[t.cat][t.s]||(o[t.cat][t.s]={}),o[t.cat][t.s][t.c]=t)})}),e.change(function(t){var e=t.target.value;global.category=e,(r=Object.keys(o[e]).map(function(t){return l(t,t.toUpperCase())})).unshift(l("","-- sector --")),a.html(r.join("\n")),n.html(l("","-- security --"))}),a.change(function(t){var e=t.target.value,a=o[global.category][e];global.sector=e,(r=Object.keys(a).map(function(t){var e=a[t];return l(e.c,e.n)})).unshift(l("","-- security --")),n.html(r.join("\n"))}),n.change(function(t){var e=t.target.value;c(o[global.category][global.sector][e])})}).catch(function(t){console.log("broken: "+t.message)}),$("#startDate").val(global.startDate).change(function(){var t=$(this).val();t&&0<t.length&&(t=t.replace("-","")),global.startDate=t}),$("#refreshBtn").click(function(){T(global.period,global.maxTryTimes)}),$(".message .close").on("click",function(){$(this).closest(".message").transition("fade")})})}).catch(function(t){console.error(t)});var v=function(t){global.cr.x||(global.cr.x=t.plotWidth+t.plotLeft-100,global.cr.y=t.plotHeight+t.plotTop-10),t.renderer.text(global.cr.t,global.cr.x,global.cr.y).css({color:"#ccc",fontSize:"2em"}).attr({zIndex:99}).add()},c=function(t){global.period=s.getPeriod(global.category),global.datum=t,T(global.period,global.maxTryTimes)},T=function(o,r){var c=global.$factSet,l=global.datum,n=s.getCounterUrl(l.c,global.category,o),i=s.getFaUrl(global.category,l.c);r--;for(var t=0;t<6;t++)c[t].text("");c[6].text("CAPITAL"),ErrorHandler.hide(),$.cacheScript(n).done(function(t,e){data=data.filter(function(t){return t[0]>global.startDate});var a=s.processData(data,{period:o,pv:l.pv});c[0].highcharts(u.getChartOptions(a),v);var r=s.Calc.ta(a),n={p:r.major.p,cagr:r.major.cagr,opt:r.opt};c[1].html(x(r)).find(".tooltip").popup({inline:!0}),"sg"==global.category||"us"==global.category?l.mv&&c[6].text("Shares {0} M, MarketCap: {1} M".format(l.mv.toFixed(4),(l.mv*n.p).toFixed(4))):"cn"!=global.category||l.c.startsWith("8")||l.c.startsWith("S")||(c[6].text("总股本 {0} 亿（{1}%流通），总市值 {2} 亿".format(Math.trunc(l.mv/1e3)/10,0<l.mv?Math.trunc(l.nv/l.mv*1e3)/10:NaN,Math.trunc(l.mv*n.p/1e3)/10)),$.cacheJSON(i).done(function(t,e){var a=s.toSeries(t.lastn),r=s.toSeries(t.ttm);global.debug||(c[2].highcharts(g.getChartOptions("FA - Annual",a)),c[3].highcharts(g.getChartOptions("FA - TTM",r)));var o=s.Calc.fa(n,a.roe);o.ttm=s.Calc.gn(n,r),o.peg=h[l.c],w(o.peg,"201608"),o.ee=p[l.c],o.peg0=m[l.c],w(o.peg0,"201703"),o.ee0=d[l.c],o.peg1=y[l.c],w(o.peg1,"201612"),o.ee1=b[l.c],c[4].html(j(o)).find(".tooltip").popup({inline:!0}),c[5].html(f.tmpls.faTable(t)).find("table:first-child").stupidtable()}).fail(function(t,e,a){ErrorHandler.show("failed to load json data:"+i)}))}).fail(function(t,e,a){console.log("failed to load data:",n),404===t.status&&0<r&&"monthly"===o&&(console.log("try again",r),T("daily",r))})},x=function(t){return e.ta(t),t.opt=s.trunc(t.opt,2),t.factor=s.trunc(t.factor,1),s.debug("taFactor:",t),f.tmpls.taFactor({ta:t})},j=function(t){return e.fa(t),t.avg=s.trunc(t.avg,2),t.gap=s.trunc(t.gap,3),s.debug("faFactor:",t),f.tmpls.faFactor({fa:t})},e={ta:function(t){var e=t.stylish||{};t.major.r2<.3?e.r2="red":t.major.r2<.5?e.r2="olive":.8<t.major.r2?e.r2="green":e.r2="teal",t.stylish=e},fa:function(e){var a=e.stylish||{};e.avg.cra<=0?a.avg="down red":a.avg="up green";a.gap={},Object.getOwnPropertyNames(e.gap).forEach(function(t){10<e.gap[t]?a.gap[t]="red":e.gap[t]<-10?a.gap[t]="green":e.gap[t]<=10&&-10<=e.gap[t]&&(a.gap[t]="yellow")}),e.stylish=a}},l=function(t,e){return"<option value='{0}'>{1}</option>".format(t,e)},w=function(t,e){Array.isArray(t)&&(3===t.length?t.push(e):t[3]=e)},a=function(t,e){var a,r=$(t);if(0<r.length)for(var o=0;o<r.length;o++)"DIV"===(a=r.get(o)).nodeName&&(e[a.id]=f.template(a.innerHTML))}});